webpackJsonp([15],{"0izA":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("woOf"),i=a.n(s),l=a("cAgV"),n={name:"ApiSuite",components:{Pagination:a("1onU").a},directives:{waves:l.a},filters:{statusFilter:function(t){return{active:"success",inactive:"info"}[t]},statusDisplayFilter:function(t){return{active:"激活",inactive:"禁用"}[t]},methodFilter:function(t){return{GET:"success",POST:"primary",PUT:"warning",DELETE:"danger",PATCH:"info"}[t]}},data:function(){return{tableKey:0,list:null,total:0,listLoading:!0,listQuery:{page:1,limit:20,name:void 0,status:void 0},statusOptions:[{key:"active",display_name:"激活"},{key:"inactive",display_name:"禁用"}],temp:{id:void 0,name:"",description:"",environment:"test",case_ids:[],config:{parallel:1,timeout:30,retry:0,stop_on_failure:!1},notifications:[],status:"active"},dialogFormVisible:!1,resultDialogVisible:!1,dialogStatus:"",textMap:{update:"编辑套件",create:"创建套件"},rules:{name:[{required:!0,message:"套件名称是必填项",trigger:"blur"}],description:[{required:!0,message:"套件描述是必填项",trigger:"blur"}],environment:[{required:!0,message:"执行环境是必填项",trigger:"change"}]},caseSearchKeyword:"",availableCases:[{id:1,label:"用户管理",children:[{id:11,label:"用户登录接口",method:"POST",path:"/api/auth/login"},{id:12,label:"获取用户信息",method:"GET",path:"/api/user/profile"},{id:13,label:"更新用户信息",method:"PUT",path:"/api/user/profile"}]},{id:2,label:"订单管理",children:[{id:21,label:"创建订单",method:"POST",path:"/api/orders"},{id:22,label:"查询订单",method:"GET",path:"/api/orders"},{id:23,label:"取消订单",method:"DELETE",path:"/api/orders/{id}"}]}],treeProps:{children:"children",label:"label"},executionResult:null}},computed:{selectedCaseList:function(){var t=this,e=[];return function a(s){s.forEach(function(s){s.children?a(s.children):t.temp.case_ids.includes(s.id)&&e.push({id:s.id,name:s.label,method:s.method,path:s.path})})}(this.availableCases),e}},created:function(){this.getList()},methods:{getList:function(){var t=this;this.listLoading=!0,setTimeout(function(){t.list=[{id:1,name:"用户管理测试套件",description:"包含用户注册、登录、信息管理等接口测试",case_count:15,status:"active",last_run:new Date("2024-01-15 10:30:00"),pass_rate:95},{id:2,name:"订单流程测试套件",description:"订单创建、支付、发货、完成等流程测试",case_count:23,status:"active",last_run:new Date("2024-01-15 09:15:00"),pass_rate:87},{id:3,name:"支付接口测试套件",description:"支付相关接口的完整测试",case_count:8,status:"inactive",last_run:new Date("2024-01-14 16:45:00"),pass_rate:62}],t.total=t.list.length,t.listLoading=!1},1e3)},handleFilter:function(){this.listQuery.page=1,this.getList()},resetTemp:function(){this.temp={id:void 0,name:"",description:"",environment:"test",case_ids:[],config:{parallel:1,timeout:30,retry:0,stop_on_failure:!1},notifications:[],status:"active"}},handleCreate:function(){var t=this;this.resetTemp(),this.dialogStatus="create",this.dialogFormVisible=!0,this.$nextTick(function(){t.$refs.dataForm.clearValidate()})},createData:function(){var t=this;this.$refs.dataForm.validate(function(e){e&&(t.temp.id=parseInt(100*Math.random())+1024,t.temp.case_count=t.temp.case_ids.length,t.temp.last_run=new Date,t.temp.pass_rate=100,t.list.unshift(t.temp),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"创建成功",type:"success",duration:2e3}))})},handleUpdate:function(t){var e=this;this.temp=i()({},t),this.temp.case_ids||(this.temp.case_ids=[]),this.temp.config||(this.temp.config={parallel:1,timeout:30,retry:0,stop_on_failure:!1}),this.temp.notifications||(this.temp.notifications=[]),this.dialogStatus="update",this.dialogFormVisible=!0,this.$nextTick(function(){e.$refs.dataForm.clearValidate()})},updateData:function(){var t=this;this.$refs.dataForm.validate(function(e){if(e){var a=i()({},t.temp);a.case_count=a.case_ids.length;var s=t.list.findIndex(function(e){return e.id===t.temp.id});t.list.splice(s,1,a),t.dialogFormVisible=!1,t.$notify({title:"成功",message:"更新成功",type:"success",duration:2e3})}})},handleDelete:function(t,e){var a=this;this.$confirm("确认删除该套件?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.list.splice(e,1),a.$notify({title:"成功",message:"删除成功",type:"success",duration:2e3})})},handleRun:function(t){var e=this;this.$message({message:"正在执行测试套件...",type:"info"}),setTimeout(function(){e.executionResult={total:t.case_count,passed:Math.floor(.8*t.case_count),failed:Math.floor(.15*t.case_count),skipped:Math.floor(.05*t.case_count),details:[{case_name:"用户登录接口",method:"POST",status:"PASS",response_time:156,error_message:""},{case_name:"获取用户信息",method:"GET",status:"PASS",response_time:89,error_message:""},{case_name:"创建订单",method:"POST",status:"FAIL",response_time:2340,error_message:"连接超时"}]},e.resultDialogVisible=!0},3e3)},handleViewReport:function(t){this.$message({message:"查看测试报告功能开发中...",type:"info"})},handleCaseCheck:function(t,e){this.temp.case_ids=e.checkedKeys},removeCaseFromSuite:function(t){var e=this.temp.case_ids.indexOf(t);e>-1&&(this.temp.case_ids.splice(e,1),this.$refs.caseTree.setCheckedKeys(this.temp.case_ids))}}},r={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("div",{staticClass:"filter-container"},[a("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{placeholder:"套件名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleFilter.apply(null,arguments)}},model:{value:t.listQuery.name,callback:function(e){t.$set(t.listQuery,"name",e)},expression:"listQuery.name"}}),t._v(" "),a("el-select",{staticClass:"filter-item",staticStyle:{width:"120px"},attrs:{placeholder:"状态",clearable:""},model:{value:t.listQuery.status,callback:function(e){t.$set(t.listQuery,"status",e)},expression:"listQuery.status"}},t._l(t.statusOptions,function(t){return a("el-option",{key:t.key,attrs:{label:t.display_name,value:t.key}})}),1),t._v(" "),a("el-button",{directives:[{name:"waves",rawName:"v-waves"}],staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:t.handleFilter}},[t._v("\n      搜索\n    ")]),t._v(" "),a("el-button",{staticClass:"filter-item",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.handleCreate}},[t._v("\n      新建套件\n    ")])],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],key:t.tableKey,staticStyle:{width:"100%"},attrs:{data:t.list,border:"",fit:"","highlight-current-row":""}},[a("el-table-column",{attrs:{label:"ID",prop:"id",sortable:"custom",align:"center",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.id))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"套件名称","min-width":"150px"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{staticClass:"link-type",on:{click:function(e){return t.handleUpdate(s)}}},[t._v(t._s(s.name))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"描述","min-width":"200px"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.description))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"用例数量",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(s.case_count))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"状态","class-name":"status-col",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("el-tag",{attrs:{type:t._f("statusFilter")(s.status)}},[t._v("\n          "+t._s(t._f("statusDisplayFilter")(s.status))+"\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"最后执行",width:"150px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",[t._v(t._s(t._f("parseTime")(s.last_run)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"通过率",width:"100px",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row;return[a("span",{style:{color:s.pass_rate>=80?"#67C23A":s.pass_rate>=60?"#E6A23C":"#F56C6C"}},[t._v("\n          "+t._s(s.pass_rate)+"%\n        ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"300","class-name":"small-padding fixed-width"},scopedSlots:t._u([{key:"default",fn:function(e){var s=e.row,i=e.$index;return[a("div",{staticClass:"button-group"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){return t.handleUpdate(s)}}},[t._v("\n            编辑\n          ")]),t._v(" "),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){return t.handleRun(s)}}},[t._v("\n            执行\n          ")]),t._v(" "),a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){return t.handleViewReport(s)}}},[t._v("\n            报告\n          ")]),t._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(e){return t.handleDelete(s,i)}}},[t._v("\n            删除\n          ")])],1)]}}])})],1),t._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.limit},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"limit",e)},pagination:t.getList}}),t._v(" "),a("el-dialog",{attrs:{title:t.textMap[t.dialogStatus],visible:t.dialogFormVisible,width:"70%"},on:{"update:visible":function(e){t.dialogFormVisible=e}}},[a("el-form",{ref:"dataForm",attrs:{rules:t.rules,model:t.temp,"label-position":"left","label-width":"100px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"套件名称",prop:"name"}},[a("el-input",{model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name",e)},expression:"temp.name"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"执行环境",prop:"environment"}},[a("el-select",{attrs:{placeholder:"请选择执行环境"},model:{value:t.temp.environment,callback:function(e){t.$set(t.temp,"environment",e)},expression:"temp.environment"}},[a("el-option",{attrs:{label:"开发环境",value:"dev"}}),t._v(" "),a("el-option",{attrs:{label:"测试环境",value:"test"}}),t._v(" "),a("el-option",{attrs:{label:"预发布环境",value:"staging"}}),t._v(" "),a("el-option",{attrs:{label:"生产环境",value:"prod"}})],1)],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"套件描述",prop:"description"}},[a("el-input",{attrs:{type:"textarea",rows:3},model:{value:t.temp.description,callback:function(e){t.$set(t.temp,"description",e)},expression:"temp.description"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"选择用例"}},[a("div",{staticClass:"case-selection"},[a("div",{staticClass:"available-cases"},[a("h4",[t._v("可用用例")]),t._v(" "),a("el-input",{staticStyle:{"margin-bottom":"10px"},attrs:{placeholder:"搜索用例","prefix-icon":"el-icon-search"},model:{value:t.caseSearchKeyword,callback:function(e){t.caseSearchKeyword=e},expression:"caseSearchKeyword"}}),t._v(" "),a("el-tree",{ref:"caseTree",attrs:{data:t.availableCases,props:t.treeProps,"show-checkbox":"","node-key":"id","default-checked-keys":t.temp.case_ids},on:{check:t.handleCaseCheck}})],1),t._v(" "),a("div",{staticClass:"selected-cases"},[a("h4",[t._v("已选用例 ("+t._s(t.temp.case_ids.length)+")")]),t._v(" "),a("el-table",{attrs:{data:t.selectedCaseList,border:"","max-height":"300"}},[a("el-table-column",{attrs:{prop:"name",label:"用例名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"method",label:"方法",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("methodFilter")(e.row.method),size:"mini"}},[t._v(t._s(e.row.method))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"path",label:"路径"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return t.removeCaseFromSuite(e.row.id)}}},[t._v("移除")])]}}])})],1)],1)])]),t._v(" "),a("el-form-item",{attrs:{label:"执行配置"}},[a("el-card",{attrs:{shadow:"never"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"并发数","label-width":"80px"}},[a("el-input-number",{attrs:{min:1,max:10},model:{value:t.temp.config.parallel,callback:function(e){t.$set(t.temp.config,"parallel",e)},expression:"temp.config.parallel"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"超时时间(s)","label-width":"80px"}},[a("el-input-number",{attrs:{min:1,max:300},model:{value:t.temp.config.timeout,callback:function(e){t.$set(t.temp.config,"timeout",e)},expression:"temp.config.timeout"}})],1)],1),t._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"失败重试","label-width":"80px"}},[a("el-input-number",{attrs:{min:0,max:5},model:{value:t.temp.config.retry,callback:function(e){t.$set(t.temp.config,"retry",e)},expression:"temp.config.retry"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"失败时停止","label-width":"80px"}},[a("el-switch",{model:{value:t.temp.config.stop_on_failure,callback:function(e){t.$set(t.temp.config,"stop_on_failure",e)},expression:"temp.config.stop_on_failure"}})],1)],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"通知设置"}},[a("el-card",{attrs:{shadow:"never"}},[a("el-checkbox-group",{model:{value:t.temp.notifications,callback:function(e){t.$set(t.temp,"notifications",e)},expression:"temp.notifications"}},[a("el-checkbox",{attrs:{label:"email"}},[t._v("邮件通知")]),t._v(" "),a("el-checkbox",{attrs:{label:"dingtalk"}},[t._v("钉钉通知")]),t._v(" "),a("el-checkbox",{attrs:{label:"wechat"}},[t._v("企业微信")])],1)],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogFormVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){"create"===t.dialogStatus?t.createData():t.updateData()}}},[t._v("确认")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"执行结果",visible:t.resultDialogVisible,width:"80%"},on:{"update:visible":function(e){t.resultDialogVisible=e}}},[t.executionResult?a("div",[a("div",{staticClass:"result-summary"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:6}},[a("el-card",[a("div",{staticClass:"stat-item"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.executionResult.total))]),t._v(" "),a("div",{staticClass:"stat-label"},[t._v("总用例")])])])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-card",[a("div",{staticClass:"stat-item success"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.executionResult.passed))]),t._v(" "),a("div",{staticClass:"stat-label"},[t._v("通过")])])])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-card",[a("div",{staticClass:"stat-item danger"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.executionResult.failed))]),t._v(" "),a("div",{staticClass:"stat-label"},[t._v("失败")])])])],1),t._v(" "),a("el-col",{attrs:{span:6}},[a("el-card",[a("div",{staticClass:"stat-item warning"},[a("div",{staticClass:"stat-value"},[t._v(t._s(t.executionResult.skipped))]),t._v(" "),a("div",{staticClass:"stat-label"},[t._v("跳过")])])])],1)],1)],1),t._v(" "),a("el-table",{staticStyle:{"margin-top":"20px"},attrs:{data:t.executionResult.details,border:""}},[a("el-table-column",{attrs:{prop:"case_name",label:"用例名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"method",label:"方法",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:t._f("methodFilter")(e.row.method),size:"mini"}},[t._v(t._s(e.row.method))])]}}],null,!1,2144848798)}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"80"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:"PASS"===e.row.status?"success":"danger",size:"mini"}},[t._v("\n              "+t._s(e.row.status)+"\n            ")])]}}],null,!1,3092425449)}),t._v(" "),a("el-table-column",{attrs:{prop:"response_time",label:"耗时(ms)",width:"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"error_message",label:"错误信息"}})],1)],1):t._e()])],1)},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(t){a("WdBa")},"data-v-21c5b0d2",null);e.default=o.exports},WdBa:function(t,e){}});
//# sourceMappingURL=15.52cbe03d2394cc274701.js.map